<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta content="width=device-width" name="viewport">
<title>Create configuration sticker</title>

<style> /* General styles */
	@page {
		size: auto;
		margin: 0;
	}
</style>

<style> /* Main section styles */
	#container {
		display: inline-block;
		border: 0.125em solid black; /* 0.125 == (2px / 1em) == (2px / 16px) */
		border-radius: 1em;
		padding: 1em;
		text-align: center;
		font-family: sans-serif;
		background: white;
	}

	#title {
		margin: 0 1em 2em;
	}

	.credentials-container {
		padding: 0 1em;
		margin: 0 1em 1em;
		border: 0.0625rem solid darkgray; /* 0.0625 == (1px / 1em) == (1px / 16px) */
	}
	.credentials-label {
		display: table;
		line-height: 1rem;
		margin: -0.5rem auto;
		padding: 0 1rem;
		background: white;
		font-size: 1.1rem;
	}
	.credentials-input {
		padding: 1.3rem 1rem;
		margin: 0 -1rem;
		font-size: 0.8rem;
		outline: none;
	}

	/* QRCode covers full width and fills required height based on width */
	#qrcode {
		position: relative;
		padding-bottom: 100%;
	}
	#qrcode canvas {
		display: none;
	}
	#qrcode img {
		position: absolute;
		height: 100%;
	}

	/* Prevents displaying line breaks in contenteditable input boxes */
	.credentials-input * {
		display: inline;
	}
	.credentials-input br {
		display: none;
	}
</style>

<style> /* Layout styles */
	/* Fills space when containers grow bigger than required by children/content */
	#container {
		display: inline-flex;
		flex-direction: column;
	}
	.credentials-container, .credentials-input {
		display: flex;
		flex-direction: column;
		flex-grow: 1;
	}
	.credentials-input {
		justify-content: center;
	}

	/* Horizontal "strip" layout */
	#layout-state-horizontal:checked ~ #container {
		flex-direction: row;
	}
	#layout-state-horizontal:checked ~ #container #title {
		display: none;
	}
	#layout-state-horizontal:checked ~ #container .credentials-container {
		margin: 0 1em 0 0;
	}
	#layout-state-horizontal:checked ~ #container .credentials-input {
		font-size: 1.4em;
	}
	#layout-state-horizontal:checked ~ #container #qrcode {
		padding-bottom: 0;
		height: 5em;
		width: 5em;
	}

	/* Disables #container border */
	#layout-state-border:checked ~ #container {
		border-color: transparent;
	}
</style>

</head>
<body>

<!-- Layout states that controls rendering -->
<input type="checkbox" hidden id="layout-state-horizontal">
<input type="checkbox" hidden id="layout-state-border">

<!-- Main section -->
<div id="container">
	<div id="title">Join configuration access point</div>
	<div class="credentials-container">
		<div class="credentials-label">SSID:</div>
		<div class="credentials-input" contenteditable role="textbox" id="ssid"></div>
	</div>
	<div class="credentials-container">
		<div class="credentials-label">PSK:</div>
		<div class="credentials-input" contenteditable role="textbox" id="psk"></div>
	</div>
	<div id="qrcode"></div>
</div>

<!-- QRCode generator -->
<script src="https://cdn.jsdelivr.net/npm/davidshimjs-qrcodejs@0.0.2/qrcode.min.js"></script>
<script>
	"use strict";

	const ssidInput = document.getElementById("ssid");
	const pskInput = document.getElementById("psk");
	const qrcode = new QRCode("qrcode");

	function makeCode() {
		const ssid = ssidInput.textContent.replace(/;/g, "\;");
		const psk = pskInput.textContent.toUpperCase();

		qrcode.clear();
		qrcode.makeCode("WIFI:T:WPA;S:" + ssid + ";P:" + psk + ";;");
	};

	ssidInput.addEventListener("input", makeCode);
	pskInput.addEventListener("input", makeCode);

	window.addEventListener("load", makeCode);

	const searchParams = new URL(window.location.href).searchParams;
	ssidInput.innerText = searchParams.get("ssid");
	pskInput.innerText = searchParams.get("psk");

</script>
