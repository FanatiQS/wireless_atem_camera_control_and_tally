<!DOCTYPE html>
<meta content="width=device-width" name="viewport">
<title>Create configuration sticker</title>

<style> /* General styles */
	@page {
		size: auto;
		margin: 0;
	}
</style>

<style> /* Main section styles */
	#container {
		display: inline-block;
		border: 0.125em solid black; /* 0.125 == (2px / 1em) == (2px / 16px) */
		border-radius: 1em;
		padding: 1em;
		text-align: center;
		font-family: sans-serif;
		background: white;
	}

	#title {
		margin: 0 1em 2em;
	}

	.credentials-container {
		padding: 0 1em;
		margin: 0 1em 1em;
		border: 0.0625rem solid darkgray; /* 0.0625 == (1px / 1em) == (1px / 16px) */
	}
	.credentials-label {
		display: table;
		line-height: 0.0625rem; /* border width */
		margin: -0.0625rem auto; /* border width */
		padding: 0 1rem;
		background: white;
		font-size: 1.1rem;
	}
	.credentials-input {
		padding: 1.3rem 1rem;
		margin: 0 -1rem;
		font-size: 0.8rem;
		outline: none;
	}

	/* QRCode covers full width and fills required height based on width */
	#qrcode {
		position: relative;
		padding-bottom: 100%;
	}
	#qrcode canvas {
		display: none;
	}
	#qrcode img {
		position: absolute;
		height: 100%;
	}

	/* Prevents displaying line breaks in contenteditable input boxes */
	.credentials-input * {
		display: inline;
	}
	.credentials-input br {
		display: none;
	}


	.view-horisontal #container {
		display: inline-flex;
		border: 0;
	}
	.view-horisontal .credentialsField {
		margin: 0 1em 0 0;
	}
	.view-horisontal .credentialsField span {
		padding: 0.3em 1em 1em;
		font-size: 1.6em;
	}
	.view-horisontal #title {
		display: none;
	}
	.view-horisontal #qrcode {
		padding-bottom: 0;
	}

</style>

<!-- Main section -->
<div id="container">
	<div id="title">Join configuration access point</div>
	<div class="credentials-container">
		<div class="credentials-label">SSID:</div>
		<div class="credentials-input" contenteditable role="textbox" id="ssid"></div>
	</div>
	<div class="credentials-container">
		<div class="credentials-label">PSK:</div>
		<div class="credentials-input" contenteditable role="textbox" id="psk"></div>
	</div>
	<div id="qrcode"></div>
</div>

<!-- QRCode generator -->
<script src="https://cdn.jsdelivr.net/npm/davidshimjs-qrcodejs@0.0.2/qrcode.min.js"></script>
<script>
	"use strict";

	const ssidInput = document.getElementById("ssid");
	const pskInput = document.getElementById("psk");
	const qrcode = new QRCode("qrcode");

	function makeCode() {
		const ssid = ssidInput.textContent.replace(/;/g, "\;");
		const psk = pskInput.textContent.toUpperCase();

		qrcode.clear();
		qrcode.makeCode("WIFI:T:WPA;S:" + ssid + ";P:" + psk + ";;");
	};

	ssidInput.addEventListener("input", makeCode);
	pskInput.addEventListener("input", makeCode);

	window.addEventListener("load", makeCode);

	const searchParams = new URL(window.location.href).searchParams;
	ssidInput.innerText = searchParams.get("ssid");
	pskInput.innerText = searchParams.get("psk");

</script>
